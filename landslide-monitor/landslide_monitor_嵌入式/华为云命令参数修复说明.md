# åä¸ºäº‘IoTå‘½ä»¤å‚æ•°å¤„ç†ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç”¨æˆ·å‘ç°äº†ä¸€ä¸ªé‡è¦çš„å‘½ä»¤å‚æ•°å¤„ç†é—®é¢˜ï¼š

### ğŸ” **é—®é¢˜ç°è±¡**
- **ç®€å•å¯åŠ¨å‘½ä»¤** âœ… æ­£å¸¸å·¥ä½œï¼š
  ```json
  {
    "paras": { 
      "enable": true, 
      "speed": 50, 
      "direction": 1, 
      "duration": 10000 
    }
  }
  ```

- **ç®€å•åœæ­¢å‘½ä»¤** âœ… æ­£å¸¸å·¥ä½œï¼š
  ```json
  {
    "paras": { 
      "enable": false 
    }
  }
  ```

- **å¤æ‚å¯åŠ¨å‘½ä»¤** + **ç®€å•åœæ­¢å‘½ä»¤** âŒ **åœæ­¢å¤±è´¥**ï¼š
  ```json
  // å¯åŠ¨å‘½ä»¤ï¼ˆå‚æ•°æ›´å¤šï¼‰
  {
    "paras": { 
      "enable": true, 
      "speed": 80,
      "direction": 2, 
      "duration": 15000,
      "pattern": 1,
      "frequency": 3000
    }
  }
  
  // åœæ­¢å‘½ä»¤ï¼ˆå‚æ•°ç®€å•ï¼‰
  {
    "paras": { 
      "enable": false  // æ²¡æœ‰å“åº”ï¼
    }
  }
  ```

## æ ¹æœ¬åŸå› åˆ†æ

### **ä»£ç é€»è¾‘é—®é¢˜**
åŸå§‹ä»£ç åœ¨å¤„ç†å‘½ä»¤æ—¶ï¼Œå¯¹å¯åŠ¨å’Œåœæ­¢å‘½ä»¤ä½¿ç”¨äº†ç›¸åŒçš„å‚æ•°è§£æé€»è¾‘ï¼š

```c
// âŒ åŸå§‹é—®é¢˜ä»£ç 
if (cJSON_IsBool(enable)) {
    bool motor_enabled = cJSON_IsTrue(enable);
    int motor_speed = cJSON_IsNumber(speed) ? speed->valueint : 50;  // æœŸæœ›speedå­˜åœ¨
    int motor_direction = cJSON_IsNumber(direction) ? direction->valueint : 1;  // æœŸæœ›directionå­˜åœ¨
    int motor_duration = cJSON_IsNumber(duration) ? duration->valueint : 0;  // æœŸæœ›durationå­˜åœ¨
    
    // æ— è®ºå¯åŠ¨è¿˜æ˜¯åœæ­¢ï¼Œéƒ½ä½¿ç”¨ç›¸åŒçš„å‚æ•°å¤„ç†é€»è¾‘
}
```

### **é—®é¢˜åˆ†æ**
1. **å‚æ•°ä¾èµ–æ€§**ï¼šä»£ç å‡è®¾æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«æä¾›
2. **è§£æé¡ºåº**ï¼šå½“æŸäº›å‚æ•°ç¼ºå¤±æ—¶ï¼Œå¯èƒ½å¯¼è‡´è§£æå¼‚å¸¸
3. **çŠ¶æ€æ··ä¹±**ï¼šåœæ­¢å‘½ä»¤å¯èƒ½è¢«ä¹‹å‰çš„å¯åŠ¨å‚æ•°å½±å“

## ä¿®å¤æ–¹æ¡ˆ

### âœ… **æ–°çš„å¤„ç†é€»è¾‘**

#### **1. é©¬è¾¾æ§åˆ¶ä¿®å¤**
```c
if (cJSON_IsBool(enable)) {
    bool motor_enabled = cJSON_IsTrue(enable);
    
    // ğŸ¯ åˆ†ç¦»å¤„ç†ï¼šåœæ­¢å‘½ä»¤ä¼˜å…ˆï¼Œç®€åŒ–å¤„ç†
    if (!motor_enabled) {
        // åœæ­¢å‘½ä»¤ï¼šåªéœ€è¦enable=false
        printf("*** STOPPING MOTOR ***\n");
        g_cloud_motor_enabled = false;
        g_cloud_motor_speed = 0;
        g_cloud_motor_direction = MOTOR_DIRECTION_STOP;
        g_cloud_motor_duration = 0;
        Motor_Off();  // ç›´æ¥åœæ­¢
    } else {
        // å¯åŠ¨å‘½ä»¤ï¼šè§£ææ‰€æœ‰å‚æ•°
        int motor_speed = cJSON_IsNumber(speed) ? speed->valueint : 50;
        int motor_direction = cJSON_IsNumber(direction) ? direction->valueint : 1;
        int motor_duration = cJSON_IsNumber(duration) ? duration->valueint : 0;
        
        // å‚æ•°éªŒè¯å’Œå¯åŠ¨å¤„ç†
        IoTCloud_HandleMotorCommand(motor_enabled, motor_speed, motor_direction, motor_duration);
    }
}
```

#### **2. RGB LEDæ§åˆ¶ä¿®å¤**
```c
if (cJSON_IsBool(enable)) {
    bool rgb_enabled = cJSON_IsTrue(enable);
    
    if (!rgb_enabled) {
        // åœæ­¢å‘½ä»¤ï¼šåªéœ€è¦enable=false
        printf("*** STOPPING RGB LED ***\n");
        g_cloud_rgb_enabled = false;
        g_cloud_rgb_red = 0;
        g_cloud_rgb_green = 0;
        g_cloud_rgb_blue = 0;
        IoTCloud_HandleRGBCommand(false, 0, 0, 0);
    } else {
        // å¯åŠ¨å‘½ä»¤ï¼šè§£æé¢œè‰²å‚æ•°
        int rgb_red = cJSON_IsNumber(red) ? red->valueint : 255;
        int rgb_green = cJSON_IsNumber(green) ? green->valueint : 255;
        int rgb_blue = cJSON_IsNumber(blue) ? blue->valueint : 255;
        
        // å‚æ•°éªŒè¯å’Œå¯åŠ¨å¤„ç†
        IoTCloud_HandleRGBCommand(rgb_enabled, rgb_red, rgb_green, rgb_blue);
    }
}
```

## æ”¯æŒçš„å‘½ä»¤æ ¼å¼

### ğŸš— **é©¬è¾¾æ§åˆ¶å‘½ä»¤**

#### **å¯åŠ¨å‘½ä»¤**ï¼ˆå®Œæ•´å‚æ•°ï¼‰
```json
{
  "service_id": "smartHome",
  "command_name": "control_motor",
  "paras": {
    "enable": true,
    "speed": 80,        // 0-100ï¼Œå¯é€‰ï¼Œé»˜è®¤50
    "direction": 1,     // 0=åœæ­¢ï¼Œ1=æ­£è½¬ï¼Œ2=åè½¬ï¼Œå¯é€‰ï¼Œé»˜è®¤1
    "duration": 10000   // æ¯«ç§’ï¼Œ0=æŒç»­è¿è¡Œï¼Œå¯é€‰ï¼Œé»˜è®¤0
  }
}
```

#### **å¯åŠ¨å‘½ä»¤**ï¼ˆæœ€ç®€å‚æ•°ï¼‰
```json
{
  "service_id": "smartHome",
  "command_name": "control_motor",
  "paras": {
    "enable": true  // å…¶ä»–å‚æ•°ä½¿ç”¨é»˜è®¤å€¼
  }
}
```

#### **åœæ­¢å‘½ä»¤**ï¼ˆæœ€ç®€å‚æ•°ï¼‰âœ… **ç°åœ¨å®Œå…¨æ”¯æŒ**
```json
{
  "service_id": "smartHome",
  "command_name": "control_motor",
  "paras": {
    "enable": false  // åªéœ€è¦è¿™ä¸€ä¸ªå‚æ•°
  }
}
```

### ğŸ”Š **èœ‚é¸£å™¨æ§åˆ¶å‘½ä»¤**

#### **å¯åŠ¨å‘½ä»¤**
```json
{
  "service_id": "smartHome",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 2000,  // Hzï¼Œå¯é€‰ï¼Œé»˜è®¤2000
    "duration": 5000,   // æ¯«ç§’ï¼Œå¯é€‰ï¼Œé»˜è®¤0
    "pattern": 1        // æ¨¡å¼ï¼Œå¯é€‰ï¼Œé»˜è®¤0
  }
}
```

#### **åœæ­¢å‘½ä»¤**
```json
{
  "service_id": "smartHome",
  "command_name": "control_buzzer",
  "paras": {
    "enable": false
  }
}
```

### ğŸ’¡ **RGB LEDæ§åˆ¶å‘½ä»¤**

#### **å¯åŠ¨å‘½ä»¤**
```json
{
  "service_id": "smartHome",
  "command_name": "control_rgb",
  "paras": {
    "enable": true,
    "red": 255,     // 0-255ï¼Œå¯é€‰ï¼Œé»˜è®¤255
    "green": 0,     // 0-255ï¼Œå¯é€‰ï¼Œé»˜è®¤255
    "blue": 0       // 0-255ï¼Œå¯é€‰ï¼Œé»˜è®¤255
  }
}
```

#### **åœæ­¢å‘½ä»¤**âœ… **ç°åœ¨å®Œå…¨æ”¯æŒ**
```json
{
  "service_id": "smartHome",
  "command_name": "control_rgb",
  "paras": {
    "enable": false  // åªéœ€è¦è¿™ä¸€ä¸ªå‚æ•°
  }
}
```

## ä¿®å¤æ•ˆæœ

### âœ… **ç°åœ¨æ”¯æŒçš„åœºæ™¯**

1. **å¤æ‚å¯åŠ¨ + ç®€å•åœæ­¢**ï¼š
   ```json
   // å¯åŠ¨ï¼šå¤æ‚å‚æ•°
   {"paras": {"enable": true, "speed": 80, "direction": 2, "duration": 15000}}
   
   // åœæ­¢ï¼šç®€å•å‚æ•° âœ… ç°åœ¨æ­£å¸¸å·¥ä½œ
   {"paras": {"enable": false}}
   ```

2. **ç®€å•å¯åŠ¨ + ç®€å•åœæ­¢**ï¼š
   ```json
   // å¯åŠ¨ï¼šç®€å•å‚æ•°
   {"paras": {"enable": true}}
   
   // åœæ­¢ï¼šç®€å•å‚æ•° âœ… ç»§ç»­æ­£å¸¸å·¥ä½œ
   {"paras": {"enable": false}}
   ```

3. **æ··åˆåœºæ™¯**ï¼š
   ```json
   // ä»»æ„å¤æ‚åº¦çš„å¯åŠ¨å‘½ä»¤
   {"paras": {"enable": true, "speed": 60, "red": 128, "frequency": 1500}}
   
   // ç»Ÿä¸€çš„ç®€å•åœæ­¢å‘½ä»¤ âœ… éƒ½èƒ½æ­£å¸¸å·¥ä½œ
   {"paras": {"enable": false}}
   ```

## è°ƒè¯•ä¿¡æ¯

### **åœæ­¢å‘½ä»¤è°ƒè¯•è¾“å‡º**
```
=== MOTOR CONTROL COMMAND ===
*** STOPPING MOTOR *** (Stop command #1)
Raw parameters: enable=false (stop command)
Calling Motor_Off() directly...
Motor_Off() called successfully
Motor stopped directly
Double-checking motor stop...
Motor stop confirmed
```

### **å¯åŠ¨å‘½ä»¤è°ƒè¯•è¾“å‡º**
```
=== MOTOR CONTROL COMMAND ===
Raw parameters: enable=true, speed=80, direction=2, duration=15000
Final parameters: enable=ON, speed=80%, direction=2, duration=15000s
*** STARTING MOTOR *** (Start command #1)
```

## æ€»ç»“

âœ… **é—®é¢˜å·²å®Œå…¨ä¿®å¤**ï¼š
- åœæ­¢å‘½ä»¤ç°åœ¨åªéœ€è¦`enable: false`å‚æ•°
- å¯åŠ¨å‘½ä»¤æ”¯æŒå®Œæ•´å‚æ•°æˆ–ä½¿ç”¨é»˜è®¤å€¼
- å‚æ•°è§£ææ›´åŠ å¥å£®ï¼Œä¸ä¼šå› ä¸ºç¼ºå¤±å‚æ•°è€Œå¤±è´¥
- é€‚ç”¨äºé©¬è¾¾ã€èœ‚é¸£å™¨ã€RGB LEDæ‰€æœ‰æ§åˆ¶å‘½ä»¤

âœ… **å‘åå…¼å®¹**ï¼š
- åŸæœ‰çš„å‘½ä»¤æ ¼å¼ç»§ç»­æ”¯æŒ
- æ–°çš„ç®€åŒ–åœæ­¢å‘½ä»¤æ ¼å¼ä¹Ÿæ”¯æŒ
- ä¸å½±å“ç°æœ‰çš„åä¸ºäº‘IoTå¹³å°é›†æˆ
