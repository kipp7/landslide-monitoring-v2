## 0. 窗口与体验（基础壳能力）
- [x] 0.1 真全屏覆盖任务栏（使用 `rcMonitor`）
- [x] 0.2 热键仅在窗口激活时生效（F11/ESC）
- [x] 0.3 Win11 圆角/深色标题栏/Mica（支持则启用）
- [x] 0.4 单实例运行（第二次启动激活已有窗口）
- [x] 0.5 窗口位置/尺寸持久化（多显示器/分辨率变化保护）
- [x] 0.6 未处理异常写入崩溃日志（LocalAppData）
- [ ] 0.7 帧率/流畅度专项优化（WebView2/WPF）
- [x] 0.8 确认 WebView2 硬件加速与 GPU 进程策略（必要时提供开关）
- [x] 0.9 增加低性能模式：限制动效/降低渲染压力（前端联动）
- [ ] 0.10 提供性能观测：开发态显示 FPS/渲染耗时（可选）
- [ ] 0.11 优化启动体验：延迟初始化非关键逻辑（避免启动卡顿）
- [ ] 0.12 处理高 DPI 缩放：窗口/网页缩放一致且可诊断
- [ ] 0.13 多显示器切换：全屏/恢复窗口时优先落在当前显示器
- [ ] 0.14 崩溃后恢复：下次启动提示并提供“清理 WebView2 缓存”入口（可选）

## 1. 系统托盘（Tray）
- [x] 1.1 添加托盘图标与资源（含多分辨率 ico）
- [x] 1.2 托盘右键菜单：打开主窗口、切换全屏、打开设置、退出
- [x] 1.3 主窗口最小化到托盘（最小化时隐藏任务栏图标）
- [x] 1.4 托盘单击/双击行为：显示并激活窗口
- [x] 1.5 托盘提示气泡（可用于“更新可用/告警通知”）
- [ ] 1.6 设置项：最小化/关闭到托盘行为可配置
- [x] 1.7 设置项：托盘启用/禁用（禁用时允许直接关闭退出）
- [x] 1.8.1 托盘菜单：显示版本号
- [x] 1.8.2 托盘菜单：打开日志目录
- [x] 1.9 托盘提示：点击可跳转指定路由（告警/更新）
- [ ] 1.10 托盘图标状态：告警时变色/叠加 badge（可选）

## 2. Windows 通知（Toast）
- [ ] 2.1 引入 Toast 通知实现（Win11 优先）
- [ ] 2.2 定义通知通道：告警、系统、更新
- [ ] 2.3 在桌面端设置页提供“允许通知”开关与状态显示
- [ ] 2.4 处理通知权限不足场景（给出引导文案/跳转设置页）
- [ ] 2.5 设计通知点击行为（打开应用并跳转到指定页面）
- [ ] 2.6 选择 Toast 实现方案（WinRT/CommunityToolkit/Notifications）
- [ ] 2.7 集成 AppUserModelID（Toast 要求）并适配安装方式
- [ ] 2.8 Toast 通知模板：标题/正文/按钮（至少 1 种）
- [ ] 2.9 Toast 点击回调：唤起应用并跳转 route（与 deep link 协同）
- [x] 2.10 设置页增加“发送测试通知”按钮

## 3. 开机自启（可选）
- [ ] 3.1 选择实现方式（注册表 Run / 计划任务）
- [ ] 3.2 在设置页提供开关（默认关闭）
- [ ] 3.3 启用/禁用时给出明确提示与错误信息
- [ ] 3.4 在不同安装方式（MSIX/非 MSIX）下验证行为

## 4. 深链接（Protocol Handler）
- [ ] 4.1 注册 `landslide://` 协议（安装时注册）
- [ ] 4.2 支持参数：`/route?path=/app/gps-monitoring&stationId=...`
- [ ] 4.3 第二次启动时将 deep link 传递给已运行实例并激活窗口
- [ ] 4.4 Host Bridge：允许前端请求“复制 deep link / 打开 deep link”

## 5. 原生文件对话框（导入/导出）
- [ ] 5.1 Host Bridge：`export:file`（SaveFileDialog）
- [ ] 5.2 Host Bridge：`import:file`（OpenFileDialog）
- [ ] 5.3 统一文件类型过滤（csv/xlsx/json/png）
- [ ] 5.4 处理取消/权限/路径非法等异常场景

## 6. 诊断与日志
- [ ] 6.1 定义日志目录与轮转策略（LocalAppData）
- [x] 6.2 增加“打开日志目录”动作（Host Bridge）
- [ ] 6.3 增加“复制版本信息/运行环境”动作（Host Bridge）
- [ ] 6.4 增加内置诊断页（Web UI 或原生对话框均可）
- [ ] 6.5 提供“一键导出诊断包”（日志 + 配置 + 版本信息）

## 7. Host Bridge 协议完善
- [x] 7.1 统一消息格式（type/action/payload）
- [x] 7.2.1 动作：`show`, `hide`
- [x] 7.2.2 动作：`focus`
- [x] 7.2.3 动作：`toggleTray`
- [x] 7.2.4 动作：`notify`（先托盘气泡，后 Toast）
- [ ] 7.3 增加返回值/回执机制（WebMessage -> WebMessage response）
- [ ] 7.4 增加权限边界：仅允许白名单动作，拒绝任意 shell 执行
- [ ] 7.5 增加 `getAppInfo` 动作：版本/运行模式/系统信息（脱敏）
- [x] 7.6 增加 `openLogsDir` 动作：打开日志目录（Explorer）
- [ ] 7.7 增加 `clearWebViewData` 动作：清理 WebView2 UserData（需确认提示）

## 8. 验收与文档
- [x] 8.1 更新 `apps/desk-win/README.md`（开发/发布/常见问题）
- [ ] 8.2 增加“交付验收清单”（托盘/通知/自启/深链接/文件对话框）
- [ ] 8.3 录制一段桌面端演示流程（可选）
- [ ] 8.4 增加桌面端自测脚本/清单（PowerShell）：启动/托盘/全屏/通知/退出

## 9. 托盘 Flyout 与后台托管体验（更像 Win 原生）
- [ ] 9.1 托盘交互：左键/右键行为明确（打开主窗/打开菜单）并与文档一致
- [ ] 9.2 托盘 Flyout：使用 WPF/WinUI 风格替代传统 ContextMenuStrip
- [ ] 9.3 托盘 Flyout：展示应用名称 + 版本号 + 当前状态（后台运行中/已打开）
- [ ] 9.4 托盘 Flyout：动作分组（打开/设置/诊断/退出）并有分割线
- [ ] 9.5 托盘 Flyout：危险动作（退出）使用明确的危险样式与二次确认（可选）
- [ ] 9.6 托盘 Flyout：点击外部自动收起（Deactivated）并避免闪烁
- [ ] 9.7 托盘 Flyout：支持 ESC 关闭
- [ ] 9.8 托盘 Flyout：定位策略贴合任务栏区域（右下角/多屏）
- [ ] 9.9 托盘 Flyout：多屏场景根据托盘所在屏幕定位（需要探测）
- [ ] 9.10 托盘 Flyout：避免被任务栏遮挡（work area + margin）
- [ ] 9.11 托盘 Flyout：不抢占焦点（可选：ShowActivated=false）
- [ ] 9.12 托盘 Flyout：按钮 hover/press 动效克制、符合深色主题
- [ ] 9.13 托盘 Flyout：动作支持快捷键提示（F11/ESC）
- [ ] 9.14 托盘 Flyout：增加“重新加载”动作（WebView2 Reload）
- [ ] 9.15 托盘 Flyout：增加“打开日志目录”动作（Explorer）
- [ ] 9.16 托盘 Flyout：增加“复制诊断信息”动作（可选）
- [ ] 9.17 托盘 Flyout：增加“清理 WebView2 缓存”动作（可选，带确认）
- [ ] 9.18 托盘 Flyout：增加“切换到本地资源/DevServer”动作（可选）
- [ ] 9.19 托盘 Flyout：支持跳转到指定页面 route（设置/GPS/设备管理）
- [ ] 9.20 托盘 Flyout：与 Settings 页的托盘开关行为一致（启用/禁用）
- [ ] 9.21 托盘图标：高分辨率 ico 多尺寸验证（16/32/48/256）
- [ ] 9.22 托盘图标：暗色任务栏下可见性验证（不发灰）
- [ ] 9.23 托盘提示：首次最小化提示仅出现一次且可关闭（可选）
- [ ] 9.24 托盘提示：提示文案产品化（不出现开发口吻）
- [ ] 9.25 托盘通知：点击气泡/Toast 后能够唤起并导航到对应页面
- [ ] 9.26 托盘通知：支持不同等级（info/warn/error）视觉区分
- [ ] 9.27 托盘通知：支持超时与手动关闭策略
- [ ] 9.28 托盘通知：避免频繁闪烁（节流/合并策略）
- [ ] 9.29 托盘菜单：支持“后台运行/退出”行为提示更明确
- [ ] 9.30 托盘菜单：支持“打开主窗口”时恢复最小化并激活
- [ ] 9.31 托盘菜单：支持“置顶显示”开关（可选）
- [ ] 9.32 托盘菜单：支持“启动时最小化到托盘”开关（可选）
- [ ] 9.33 托盘菜单：支持“关闭窗口时最小化到托盘”开关（可选）
- [ ] 9.34 托盘菜单：支持“退出软件”前确认当前账号（可选）
- [ ] 9.35 托盘 Flyout：窗口圆角/阴影与 Win11 风格一致
- [ ] 9.36 托盘 Flyout：Mica/Backdrop（可选，支持则启用）
- [ ] 9.37 托盘 Flyout：字体与颜色与 Web UI 主题一致
- [ ] 9.38 托盘 Flyout：无障碍（Tab 焦点可见）
- [ ] 9.39 托盘 Flyout：鼠标滚轮/触控板不误触（可选）
- [ ] 9.40 托盘 Flyout：验收脚本覆盖（打开/关闭/定位/导航）

## 10. 全屏/窗口/多屏与 DPI（稳定性）
- [ ] 10.1 全屏：确保覆盖任务栏（Topmost + SetWindowPos + rcMonitor）
- [ ] 10.2 全屏：进入/退出全屏动画与过渡不闪烁
- [ ] 10.3 全屏：退出全屏后恢复上一次窗口位置/大小（含多屏）
- [ ] 10.4 全屏：ESC 仅在全屏时注册热键（避免影响其他软件）
- [ ] 10.5 全屏：F11 热键冲突时给出提示（注册失败处理）
- [ ] 10.6 全屏：全屏下禁用拖拽移动与调整大小
- [ ] 10.7 全屏：全屏下隐藏系统菜单（Alt+Space）干扰（可选）
- [ ] 10.8 窗口：最小化到托盘时不丢失 WebView2 状态（导航/表单）
- [ ] 10.9 窗口：从托盘恢复时强制激活并置前（避免在后台）
- [ ] 10.10 窗口：单实例激活时带上 deep link 参数（若有）
- [ ] 10.11 多屏：窗口保存的屏幕消失时回退到主屏（已实现后回归）
- [ ] 10.12 多屏：全屏优先在当前屏幕，不跨屏拉伸
- [ ] 10.13 多屏：切换屏幕后窗口状态保存并恢复正确
- [ ] 10.14 DPI：125%/150%/175% 下 UI 不模糊（WPF + WebView2）
- [ ] 10.15 DPI：DPI 变化时 WebView2 缩放策略一致（可诊断）
- [ ] 10.16 DPI：标题栏/系统按钮区域点击命中正确（无偏移）
- [ ] 10.17 DPI：托盘 Flyout 定位在高 DPI 下不偏移
- [ ] 10.18 DPI：消息框/对话框字体不发虚（统一字体）
- [ ] 10.19 窗口：最小尺寸策略合理（不强制过大，适配 1366x768）
- [ ] 10.20 窗口：支持记忆是否最大化启动（可选）
- [ ] 10.21 窗口：支持“启动时全屏”开关（可选）
- [ ] 10.22 窗口：支持“启动时固定在某个屏幕”开关（可选）
- [ ] 10.23 窗口：支持“窗口置顶”开关（可选）
- [ ] 10.24 窗口：窗口标题动态更新（与 Web 路由/页面 title 同步）
- [ ] 10.25 窗口：支持拖拽窗口边缘调整大小（非全屏）
- [ ] 10.26 窗口：支持双击标题栏最大化/还原（若使用自绘）
- [ ] 10.27 窗口：崩溃恢复后提示“是否恢复上次页面”（可选）
- [ ] 10.28 窗口：处理 WebView2 初始化失败时的回退流程更友好
- [ ] 10.29 窗口：错误页支持复制错误详情与日志路径
- [ ] 10.30 窗口：验收脚本覆盖（全屏/多屏/DPI）

## 11. WebView2 性能与兼容（帧率/稳定）
- [ ] 11.1 性能：默认启用 GPU 加速，提供禁用 GPU 的开关（诊断）
- [ ] 11.2 性能：开发模式显示渲染信息（WebGL renderer / DPI / cores）
- [ ] 11.3 性能：提供 FPS 观测（可选：Web 内测面板）
- [ ] 11.4 性能：降低首屏白屏时间（延迟非关键初始化）
- [ ] 11.5 性能：WebView2 导航/Reload 时 LoadingOverlay 状态流转一致
- [ ] 11.6 性能：避免重复注入脚本导致内存增长（host info 注入幂等）
- [ ] 11.7 性能：避免频繁 CoreWebView2.Reload 造成卡顿（节流）
- [ ] 11.8 性能：支持缓存清理后自动重启 WebView2（可选）
- [ ] 11.9 兼容：检测 WebView2 Runtime 缺失并给出安装引导
- [ ] 11.10 兼容：支持固定 WebView2 userDataFolder（已实现后回归）
- [ ] 11.11 兼容：处理代理/证书拦截导致的导航失败（提示更友好）
- [ ] 11.12 兼容：本地资源加载（VirtualHostName）路径验证与降级
- [ ] 11.13 兼容：dev server 不可用时提示并提供“一键切换本地资源”
- [ ] 11.14 兼容：dev server URL 校验（必须 http/https，末尾 /）
- [ ] 11.15 兼容：限制外链打开策略（浏览器打开 vs 内嵌）
- [ ] 11.16 兼容：处理下载文件的行为（保存到默认下载目录，可选）
- [ ] 11.17 兼容：处理 PDF 打开（浏览器/内置）策略（可选）
- [ ] 11.18 兼容：处理剪贴板访问（复制）权限与失败提示
- [ ] 11.19 兼容：处理权限请求（摄像头/麦克风）策略（如果未来需要）
- [ ] 11.20 兼容：处理窗口关闭时 WebView2 释放，避免残留进程
- [ ] 11.21 兼容：处理窗口隐藏到托盘时是否降频渲染（可选）
- [ ] 11.22 兼容：处理系统休眠/唤醒后的网络重连（可选）
- [ ] 11.23 兼容：处理系统时间变化对证书/缓存的影响（可选）
- [ ] 11.24 兼容：处理跨域/CORS 失败时提示对接文档入口（可选）
- [ ] 11.25 兼容：收敛 WebView2 启动参数，避免与用户环境冲突
- [ ] 11.26 兼容：记录 additionalArgs 到诊断包（便于排查）
- [ ] 11.27 兼容：处理渲染崩溃（Renderer crash）并自动提示重启
- [ ] 11.28 兼容：处理导航到错误页面的回退（Back/Reload）
- [ ] 11.29 兼容：处理 hash router 与 deep link 的一致性
- [ ] 11.30 性能：验收场景覆盖（登录页地形动画/大屏/ECharts）

## 12. 日志/诊断/崩溃恢复（可维护）
- [ ] 12.1 诊断：统一日志目录结构（app/logs/crash/webview）
- [ ] 12.2 诊断：日志轮转策略（大小/数量/保留天数）
- [ ] 12.3 诊断：增加“复制日志路径”按钮（托盘/设置/错误页）
- [ ] 12.4 诊断：增加“导出诊断包”动作（zip：日志+配置+版本）
- [ ] 12.5 诊断：诊断包中加入 OS 版本/硬件/显卡信息（脱敏）
- [ ] 12.6 诊断：诊断包中加入 WebView2 版本与浏览器版本号
- [ ] 12.7 诊断：诊断包中加入应用配置（隐去 token/敏感信息）
- [ ] 12.8 诊断：崩溃后启动提示“已写入崩溃日记”并提供打开入口
- [ ] 12.9 诊断：崩溃原因提取（stacktrace）展示在错误页（可复制）
- [ ] 12.10 诊断：WebView2 缓存损坏时提示“清理缓存并重启”
- [ ] 12.11 诊断：增加“恢复默认窗口状态”入口（清理 window-state.json）
- [ ] 12.12 诊断：增加“恢复默认设置”入口（清理 localStorage / settings）
- [ ] 12.13 诊断：增加“网络连通性测试”入口（ping baseUrl，可选）
- [ ] 12.14 诊断：增加“截图当前窗口”入口（可选，用于反馈）
- [ ] 12.15 诊断：自动收集“最近一次 API 错误”摘要（可选）
- [ ] 12.16 诊断：与 `docs/AI_WORKLOG.md` 链接互通（排查入口）
- [ ] 12.17 诊断：错误页提供“复制环境信息”一键按钮（可选）
- [ ] 12.18 诊断：错误页提供“上报问题”入口（打开 issue/邮箱，可选）
- [ ] 12.19 诊断：验收脚本覆盖（生成诊断包/打开日志/清理缓存）
- [ ] 12.20 诊断：确保无敏感信息写入日志/诊断包（安全审查）

## 13. 安全与权限边界（桌面壳约束）
- [ ] 13.1 Bridge：仅允许白名单 action（已做后回归补齐）
- [ ] 13.2 Bridge：拒绝任意命令执行（open external 限制协议）
- [ ] 13.3 Bridge：openLogsDir 仅允许打开应用自身目录
- [ ] 13.4 Bridge：notify route 仅允许 `/app/*` 内部路由
- [ ] 13.5 Bridge：对来自 Web 的 payload 做 schema 校验（长度/类型）
- [ ] 13.6 Bridge：对异常输入统一捕获并写入诊断日志
- [ ] 13.7 WebView2：禁用不必要能力（如需要：DevTools 开关）
- [ ] 13.8 WebView2：限制导航到非白名单域名（生产模式）
- [ ] 13.9 WebView2：限制 file:// 访问与本地资源映射范围
- [ ] 13.10 Token：避免在日志/错误页泄露 token 或敏感字段
- [ ] 13.11 更新：校验下载产物签名（若引入 updater）
- [ ] 13.12 更新：下载源固定并支持证书 pinning（可选）
- [ ] 13.13 隐私：收集的硬件信息脱敏并可关闭（可选）
- [ ] 13.14 合规：第三方库清单与版本记录（WebView2/依赖）
- [ ] 13.15 安全：完成一次桌面壳威胁建模与记录（简版）

## 14. 产品体验细节（交付感）
- [ ] 14.1 标题栏：深色标题栏与系统按钮对比度达标
- [ ] 14.2 圆角：Win11 圆角在非全屏/全屏时表现一致
- [ ] 14.3 Backdrop：支持则启用 Mica，效果不“阴森”
- [ ] 14.4 启动：Splash/LoadingOverlay 文案与品牌一致
- [ ] 14.5 启动：加载过程显示当前模式（DevServer/本地资源）
- [ ] 14.6 启动：加载失败给出可操作指引（启动 dev server/切换本地）
- [ ] 14.7 退出：退出时提示是否最小化到托盘（取决于设置）
- [ ] 14.8 退出：退出软件二次确认显示当前账号
- [ ] 14.9 退出：退出后清理托盘图标与后台进程（无残留）
- [ ] 14.10 更新：发现新版本时提示更友好（可选）
- [ ] 14.11 声音：告警提示音（可选，默认关闭）
- [ ] 14.12 声音：提示音与通知策略一致（节流）
- [ ] 14.13 可视化：在“设置-诊断”显示渲染模式（GPU/软件）
- [ ] 14.14 可视化：在“设置-诊断”显示 WebView2 浏览器版本号
- [ ] 14.15 演示：准备一个“演示模式”数据集（全部 mock 可跑）
