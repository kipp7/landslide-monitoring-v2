## 1. 本地运行基线（Local Runtime Baseline）
- [ ] 1.1 盘点当前 `infra/compose` 与本地脚本现状（能否一键起 DB）
- [ ] 1.2 明确端口分配与冲突策略（3000/5174/8080 等）
- [ ] 1.3 明确最小依赖：Postgres + ClickHouse（可按服务拆分）
- [ ] 1.4 输出一份“本地启动 SOP”（不依赖个人环境）
- [ ] 1.5 输出一键启动脚本（Windows PowerShell）
- [ ] 1.6 输出停机/清理脚本（停止 compose、清理 volume 可选）
- [ ] 1.7 提供 demo 数据初始化脚本（最小可用数据）
- [ ] 1.8 增加本地健康检查总览脚本（检查端口/DB/进程）
- [ ] 1.9 文档化“常见问题”与排查路径（端口占用/权限）

## 2. API Service 可构建可启动
- [ ] 2.1 `npm -w services/api run build` 可通过
- [ ] 2.2 `npm -w services/api run start` 可启动并监听预期端口
- [ ] 2.3 `/health` 200 OK（含基本信息：version、uptime）
- [ ] 2.4 增加 `dev` 脚本（热重载可选）
- [ ] 2.5 统一日志级别（debug/info/warn/error）与默认输出
- [ ] 2.6 增加 CORS 策略（供 `apps/desk` 联调）
- [ ] 2.7 输出 API 路由清单（启动时打印或提供 `/routes`）
- [ ] 2.8 实现 graceful shutdown（退出时关闭 DB 连接）
- [ ] 2.9 启动自检：配置缺失时给出可读提示并退出
- [ ] 2.10 增加最小 smoke（启动后请求 `/health`）脚本

## 3. 配置与环境变量
- [ ] 3.1 清理/补齐 `services/api/.env.example`（仅保留必要项）
- [ ] 3.2 统一本地默认配置（无 `.env` 也能启动，或启动时给出明确提示）
- [ ] 3.3 认证开发通行证：`Authorization: Bearer dev`（仅开发环境）
- [ ] 3.4 区分 dev/test/prod 配置层（优先 dev 默认）
- [ ] 3.5 统一配置加载顺序（env -> .env -> defaults）
- [ ] 3.6 敏感信息不落盘策略（仅 env，不提交到仓库）
- [ ] 3.7 增加 config dump 诊断开关（隐藏敏感字段）
- [ ] 3.8 定义桌面端对接的 baseUrl 约定与文档（如 `DESK_API_BASE_URL`）

## 4. 数据库连通性
- [ ] 4.1 Postgres 连接成功（启动时自检并输出清晰日志）
- [ ] 4.2 ClickHouse 连接成功（可延迟初始化，但必须可诊断）
- [ ] 4.3 增加最小 schema 初始化策略（迁移/SQL 脚本/启动检查）
- [ ] 4.4 确定迁移策略（迁移工具/SQL 目录/启动时检查）
- [ ] 4.5 ClickHouse 初始化：database/table/TTL（按最小写入设计）
- [ ] 4.6 DB 健康检查：输出连接耗时与错误详情（脱敏）
- [ ] 4.7 连接池与超时配置（Postgres/ClickHouse）
- [ ] 4.8 Postgres demo seed（站点/设备/传感器/告警最小集）
- [ ] 4.9 ClickHouse demo seed（时间序列最小集，可选）
- [ ] 4.10 启动日志输出 DB 版本与目标地址（脱敏）

## 5. 最小联调接口（只读优先）
- [ ] 5.1 站点树/站点列表查询（供设备管理/GPS 页面）
- [ ] 5.2 设备列表与状态查询（供设备管理页面）
- [ ] 5.3 GPS 时间序列查询（供 GPS 监测趋势/表格）
- [ ] 5.4 告警事件列表（供首页/大屏/通知）
- [ ] 5.5 站点详情查询（含设备/传感器摘要）
- [ ] 5.6 设备详情查询（含传感器列表与最后上报）
- [ ] 5.7 设备实时数据查询（最近一条/最近 N 条）
- [ ] 5.8 告警详情查询（含关联站点/设备/测点）
- [ ] 5.9 系统字典/枚举接口（供前端统一显示）
- [ ] 5.10 错误返回 shape 对齐前端 `ApiError` contract

## 6. 可观测性与排障
- [ ] 6.1 启动日志包含：环境、端口、DB 连接结果
- [ ] 6.2 请求日志与错误日志可区分（必要时带 requestId）
- [ ] 6.3 关键失败时返回可读错误（不要只抛栈）
- [ ] 6.4 增加慢请求日志（阈值可配置）与耗时统计

## 7. 验收
- [ ] 7.1 新机器按 SOP 启动成功（DB + API）
- [ ] 7.2 `curl http://localhost:<port>/health` 返回 200
- [ ] 7.3 桌面端切换 HTTP 模式时，至少能请求到一个只读接口（不崩溃）
